
# **Тема: Формирование данных для машинного обучения в формате NumPy на основе датасета S3DIS**


---

### **Цель работы**

В ходе выполнения данной работы были поставлены и достигнуты следующие цели:
- Изучен и применен на практике процесс загрузки 3D облаков точек из датасета S3DIS.
- Сформирован единый массив данных в формате NumPy, объединяющий геометрические признаки, цветовую информацию и метки семантических классов.
- Реализована базовая предобработка данных, включающая нормализацию координат и цветовых каналов.
- Подготовлен и сохранен итоговый набор данных в формате `.npy`, пригодном для непосредственной подачи в модели машинного обучения, такие как PointNet++ в фреймворке PyTorch.

**Примечание:** Ввиду значительного объема полного датасета (более 270 млн. точек) и ограниченности вычислительных ресурсов, все операции были произведены на подмножестве данных, а именно на всех помещениях из **`Area_1`**. Разработанный скрипт является масштабируемым и может быть применен ко всему датасету без изменения логики.

---

### **Результаты выполнения**

В ходе работы был получен скрипт на языке Python, который автоматизирует весь процесс обработки данных. В результате его выполнения для `Area_1` были сгенерированы следующие артефакты:

1.  **Основной файл данных:** `s3dis_dataset.npy`
2.  **Скриншот первых 5 строк обработанного массива:** `s3dis_head_output.txt`
3.  **Гистограмма распределения классов:** `label_distribution.png`

#### **Вывод первых 5 строк массива**


![Содержимое файла `s3dis_head_output.txt`:](area1txt.jpeg)

#### **Гистограмма распределения классов для Area_1**

![Распределение классов в Area_1](Area_1_label_distribution.png)

---

### **Ответы на контрольные вопросы**

#### **Общие вопросы по датасету S3DIS**

**1. Что такое S3DIS и для чего он используется?**

S3DIS (Stanford 3D Indoor Scene Dataset) — это крупномасштабный публичный датасет, предназначенный для задач анализа и понимания 3D-сцен внутри помещений. Он состоит из набора цветных 3D облаков точек, полученных путем сканирования реальных офисных пространств. Основное применение датасета — обучение и оценка моделей глубокого обучения для задачи **семантической сегментации 3D облаков точек**, где требуется классифицировать каждую точку в пространстве, присвоив ей метку определенного класса (стена, пол, стул и т.д.).

**2. Какие типы данных содержит S3DIS?**

Каждая точка в датасете S3DIS представлена вектором из 6 признаков:
- **Геометрические координаты (X, Y, Z):** Вещественные числа, определяющие положение точки в трехмерном пространстве.
- **Цветовая информация (R, G, B):** Целочисленные значения в диапазоне [0, 255], описывающие цвет точки.
Помимо этого, для каждой точки предоставляется **семантическая метка класса**, которая используется в качестве целевой переменной при обучении с учителем.

**3. Сколько пространств (Areas) включает датасет?**

Полный датасет S3DIS включает **6 больших пространств (Areas)**, каждое из которых представляет собой отдельный этаж или секцию здания и содержит множество различных помещений (офисы, коридоры, конференц-залы). В рамках данной работы была полностью обработана `Area_1`.

**4. Что представляют собой строки в .txt файлах S3DIS? Опишите формат.**

Каждый `.txt` файл в аннотациях S3DIS содержит облако точек, принадлежащее одному семантическому классу в пределах одного помещения. Каждая строка в файле соответствует одной точке и имеет следующий формат:
`X Y Z R G B`
Это 6 численных значений, разделенных пробелом, где первые три — координаты типа `float`, а последние три — значения цвета типа `int`.

**5. Какие задачи машинного обучения можно решать с помощью S3DIS?**

S3DIS является бенчмарком для решения следующих задач:
- **Семантическая сегментация 3D:** Основная задача, где модели (например, PointNet, PointNet++, RandLA-Net) учатся предсказывать класс для каждой точки.
- **Сегментация экземпляров (Instance Segmentation):** Более сложная задача, требующая не только классифицировать точки, но и различать отдельные объекты одного класса (например, стул_1, стул_2).
- **Классификация 3D объектов и сцен:** После сегментации можно решать задачи классификации целых объектов или помещений.

**6. Какие классы (объекты) включены в разметку S3DIS? Приведите примеры.**

В датасете S3DIS предусмотрено **13 семантических классов**. Они охватывают как структурные элементы зданий, так и мебель. Примеры классов:
- *Структурные элементы:* `ceiling` (потолок), `floor` (пол), `wall` (стена), `column` (колонна), `window` (окно), `door` (дверь).
- *Мебель и объекты:* `table` (стол), `chair` (стул), `sofa` (диван), `bookcase` (книжный шкаф).
- *Прочее:* `clutter` (разное/мусор) — класс для объектов, не вошедших в другие категории.

---

#### **Вопросы по подготовке данных**

**7. Какие признаки можно извлекать из данных S3DIS для обучения модели?**

Для обучения модели из S3DIS извлекаются следующие признаки:
- **Исходные признаки:** Координаты `X, Y, Z` и цвета `R, G, B`. Современные архитекторы, такие как PointNet, способны эффективно работать напрямую с этими сырыми данными.
- **Нормализованные признаки:** В ходе предобработки координаты и цвета приводятся к стандартному диапазону (например, [-1, 1] для координат и [0, 1] для цветов), что является стандартной практикой.
- **Инженерные (вычисляемые) признаки:** Дополнительно можно вычислить локальные геометрические дескрипторы для каждой точки, такие как нормали к поверхности, кривизна, или пространственные признаки (например, высота точки `Z` относительно пола).

**8. Что такое нормализация координат, и зачем она нужна при подготовке 3D данных?**

Нормализация координат — это процесс преобразования абсолютных координат точек в стандартную систему, обычно центрированную в начале координат и вписанную в единичный куб или сферу. В выполненной работе была применена нормализация путем центрирования (вычитание среднего значения по каждой оси) и масштабирования (деление на максимальное абсолютное значение). Это необходимо по трем ключевым причинам:
1.  **Инвариантность к положению:** Модель не должна зависеть от того, в какой части глобальной системы координат находился сканер. Нормализация делает модель устойчивой к сдвигам.
2.  **Инвариантность к масштабу:** Модель должна одинаково распознавать объекты вне зависимости от их размера в исходных единицах измерения.
3.  **Ускорение и стабилизация обучения:** Нейронные сети обучаются значительно эффективнее на данных, распределенных в небольшом диапазоне вокруг нуля.

**9. Почему важно сохранять данные в формате NumPy ( .npy , .npz ) при работе с ML-моделями?**

Сохранение данных в бинарных форматах NumPy (`.npy`, `.npz`) является стандартом в ML по следующим причинам:
- **Производительность:** Чтение и запись бинарных `.npy` файлов на порядки быстрее, чем парсинг текстовых форматов (`.txt`, `.csv`), так как не требует преобразования символов в числа.
- **Эффективность по памяти:** Бинарный формат занимает значительно меньше места на диске, так как хранит числа в их "родном" представлении (например, 4 байта на `float32`).
- **Сохранение типов данных:** Формат `.npy` сохраняет не только значения, но и точный тип данных массива (`float32`, `int64` и т.д.), что исключает ошибки при загрузке в ML-фреймворки.

**10. Как разделить данные на входные признаки и метки классов?**

Если данные хранятся в едином NumPy-массиве, где последний столбец является меткой класса, разделение выполняется элегантно и эффективно с помощью срезов (slicing). Этот метод не требует копирования данных в памяти, что делает его очень быстрым.

```python
# Предположим, 'dataset' — это наш итоговый массив формы (N, 7),
# где N - количество точек.
# Столбцы 0-5: признаки (X, Y, Z, R, G, B)
# Столбец 6: метка (label)

# features получает все строки и все столбцы, кроме последнего.
features = dataset[:, :-1]  

# labels получает все строки, но только последний столбец.
labels = dataset[:, -1]   

# Проверка размерностей:
# features.shape будет (N, 6)
# labels.shape будет (N,)
```

**11. Чем отличается np.save() от np.savez() и np.savez_compressed() ?**

*   **`np.save()`**: Сохраняет **один** массив NumPy в бинарный файл с расширением `.npy`. Это самый быстрый способ сохранить один объект.
*   **`np.savez()`**: Сохраняет **несколько** массивов в один **несжатый** архив `.npz`. По сути, это zip-архив, содержащий внутри несколько `.npy` файлов. Удобно для группировки данных (например, `data` и `labels`).
*   **`np.savez_compressed()`**: Аналогичен `np.savez()`, но применяет алгоритм сжатия к сохраняемым данным. Это позволяет существенно сэкономить место на диске (особенно для разреженных данных или меток), но незначительно увеличивает время чтения и записи.

**12. Какие потенциальные проблемы могут возникнуть при чтении и обработке S3DIS?**

В ходе работы были выявлены следующие проблемы:
*   **Высокое потребление оперативной памяти (RAM):** Поскольку датасет содержит сотни миллионов точек, попытка загрузить их все в список, а затем объединить (`np.vstack`), приводит к переполнению памяти и аварийному завершению процесса (OOM Kill). Решение — предварительное выделение памяти под итоговый массив и его заполнение по частям.
*   **Ошибки в данных (Data Corruption):** В некоторых файлах (например, в `Area_5`) встречаются строки с некорректными символами (сбои кодировки или записи), которые невозможно преобразовать в числа. Код должен обрабатывать исключения при чтении, чтобы не прерывать весь процесс из-за одного битого файла.
*   **Дисбаланс классов:** Количество точек для разных классов варьируется на порядки (например, стен и полов гораздо больше, чем стульев или балок). Это может негативно сказаться на обучении модели, если не применять техники взвешивания классов или аугментации.

